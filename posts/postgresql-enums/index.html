<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Beyond True & False: Enumerated Data Types in Postgresql & Rails | Hello, World extended </title>
  <meta name="description" content="Using the Enumerated Data Type in Postgresql & Rails">
  <meta name="keywords" content="rails, postgresql, enumerated">
  <link rel="stylesheet" href="/css/main.css">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="theme-color" content="#2ecc71">
  <script
    src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?autoload=true&skin=sunburst&lang=js&lang=ruby"
    defer=""></script>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-52446115-1']);
    _gaq.push(['_trackPageview']);
    (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

</head>

<body class="single">
  <main class="container">
    <header class="site-header">
      <div class="container txt-center">
        <nav class="navbar">
          <ul>
            <li><a href="/">home</a></li>
            <li class="divider">&bull;</li>
            <li><a href="/about">about</a></li>
            <li class="divider">&bull;</li>
            <li><a href="/feed.xml" target="_blank"><i class="icon icon-feed"></i> feed</a></li>
          </ul>
        </nav>
        <a href="/" class="author-thumb">
          <img src="/images/author.jpg" alt="Author thumbnail" class="dot">
        </a>
        <h1>Hello, World extended <small>...</small></h1>

        <hr class="hr">
      </div>
    </header>
    <section class="main-content">
      <article class="post">
        <header class="post-header">
          <h1 class="post-title">Beyond True & False: Enumerated Data Types in Postgresql & Rails</h1>
          <p class="post-meta">Jan 29, 2020</p>
        </header>
        <h4>Multiple Choice</h4>
        <p>
          One of the great advantages of Postgresql in comparison to more limiting databases like SQLite is the <a href='https://www.postgresql.org/docs/current/datatype.html#DATATYPE-TABLE'>number of data type options</a> available for database customization. The current version of Postgresql offers dozens of data types as options, compared to SQlite3's fairly limiting five data types, of which one (BLOB) is nearly useless.
        </p>

        <p>
          One datatype that I have found useful for implementation is the <em>enum</em> type. Enums present yet another way to for a data architect to store values that have a limited number of potential options. By setting your accepted values for a column in advance, you have built in some validations, signified to other developers what options are acceptable for the column, and nicely cleaned parts of your data structure.
        </p>
        
        <p>
          Before getting too far into enums, it is approprate to look at what other options are available to those not ready to make the plunge.
            <ol type="1">
              <li>
                <strong>Boolean</strong>: If your options can be summed up as a simple or-else condition with only two potential values, a boolean often makes sense, particuarly if your logic can be reasoned linguistically as 'my-instance-is-in-this-state-or-not'. Problems can however arise when we mix trues and falses with NULLs, since both false and NULL will be declared 'falsy' by most coding languages.
              </li>
              <li>
                <strong>String</strong>: Another option to develop a multiple choice field for your database is to only provide a limited number of specific values. While this works closest to what enumerables will do, there a number of extra steps involved. Notably, you will likely have to provide at least one custom validation for your instances that may require quite a bit of typing. You also lose much of the built-in logic that comes with the boolean type of data, since all strings will evaluate to truthy.
              </li>
              <li>
                <strong>Join Table</strong>: You could give your option values their own table in the database and utilize foreign keys to connect one with your instance. This is probably the preferred method if your options will need other data associated with them and you plan to nest other models of your options. Rails will also build in some of the logic, allowing you to quickly and easily get all instances with one option without having to building your own search query or enumerator method, for example. However, if you are not building more data off your options, it can lead to deeper nesting in your data serializers than you would otherwise have.
              </li>
            </ol>
        </p>

        <h4>Setting Up Your Postgresql Database in Rails to Accept An Enumerated Data Type</h4>

        <p>
          In exploring the enumerated data type (henceforth, 'enum') of Postgresql for the first time (alongside the uuid data type, which is a blog for another day), I made frequent use of other blogs and stack overflow posts that delivered step-by-step instructions.
        </p>

        <p>
          Changing state in React, on the other hand, does not necessarily require sending a request to a server, just the DOM. The advantage of calling <strong>setState</strong> asynchronously is that React can batch multiple updates. An application with many components will likely have event handlers on multiple components that will call <strong>setState</strong>. If a parent and child components both call setState from the same click event, React will batch the two calls together, which avoids re-rendering components twice. This can only be completed asynchronously.
        </p>

        <p>
          Below is an example of a duel call to <strong>setState</strong>. Both the parent (Applet) and child (Header) div are listening for clicks and are programmed to change the same state attribute. 
        </p>

  <pre class="prettyprint lang=js">
    <code>
import React from 'react'
import Header from './Header'

export default class Applet extends React.Component {
  constructor() {
      super()
      this.state = {
          myState: 'bored' }
  }

  updateMyState = () => {
      this.setState({myState: 'hungry'})
  }

  updateMyStateFromChild= () => {
      this.setState({myState: 'intrigued'})
      }

  render() {
      console.log(this.state.myState) // logs 'bored' to console at initial render, then 'hungry' on subsequent clicks
      return (
          >div onClick={this.updateMyState} style={{backgroundColor: 'yellow'}}>
              >Header passedState={this.state} passedMethod={this.updateMyStateFromChild} />
          >/div>
  )}
}

// Header.js
import React from 'react'

class Header extends React.Component {
	
	render() {
		// console.log(this.props.myState)
		return >div onClick={this.props.passedMethod}>
			>div>My State is {this.props.passedState.myState}>/div> //displays state as bored on initial render, and then hungry after other clicks.
		>div>
	}
}

export default Header
    </code>
  </pre>

          <p>
            While we cannot witness a state change to the value of 'intrigued' with this code, the applet does not break and React manages the handle the state change with ease.
          </p>

          <p>
            But, what if we don't use <strong>setState()</strong> in this dual situation? What if we try to set things with our old friend, '=' ?
          </p>

  <pre class="prettyprint lang=js">
    <code>
import React from 'react'
import Header from './Header'

export default class Applet extends React.Component {
    constructor() {
        super()
        this.state = {
            myState: 'bored' }
    }

    updateMyState = () => { 
        this.state.myState = 'hungry'
        console.log(this.state.myState)
    }

    updateMyStateFromChild= () => { 
        this.state.myState = 'intrigued'
        console.log(this.state.myState)    
    }

    render() {
        console.log(this.state.myState) // logs 'bored' to console at initial render, then both 'hungry' and 'intrigued' on subsequent clicks
        return (
            >div onClick={this.updateMyState} style={{backgroundColor: 'yellow'}}>
                >Header passedState={this.state} passedMethod={this.updateMyStateFromChild} />
            >/div>
    )}
}


// Header.js
import React from 'react'

class Header extends React.Component {
	
	render() {
		return >div onClick={this.props.passedMethod}>
			>div>My State is {this.props.passedState.myState}>/div> //displays state as bored on initial render, and does not change with the clicks.
		>div>
	}
}
    </code>
  </pre>

          <p>
            While setState() will automatically fire off processes to rerender our affected components, simply reassigning our state, does not cause anything to change on the DOM.
          </p>

          <p>
            Interestingly enough, if we were to call our parent class's render method from within our state changing method. And when we do, the console.log() in the method will log our updated state value, but the child component will still not rerender on the DOM with the updated state value. (It is being returned to our update method, not the React parent component.)
          </p>

          <p>
            By compiling multiple requests of setState before changing the state, React is also able to edit multiple components in one go, which improves performance.
          </p>


        <h4>SetState in the Component Lifecycle</h4>
        
        <p>
          The setState() method is only available at certain parts of the component lifecycle. While it is not technically available in the constructor() method, <strong>this.state</strong> can be set equal to a JavaScript object to provide the component's state with initial values. 
        </p>

          <p>
            As we discovered earlier, setState() is not really available during the render() due to stack overflow from infinite recursion. SetState() is available during the ComponentDidMount() phase.
          </p>

          <p>
            While calling setState() in ComponentDidMount() will trigger additional rendering, it occurs before React updates the screen, so the user experience is largely unaffected. React's documentation suggests avoiding setState() here except for cases where the state may be dependent on screen measurement (for example, what space is available for modals), since almost everything else could be set in the constructor.
          </p>

          <p>
            ComponentDidUpdate() also allows us to call setState(), which is highly sensible. However, the setState() call must be wrapped in a conditional statement to avoid an infinite loop.
          </p>

          <p>
            An alternative to calling setState() within ComponentDidUpdate() is to call it within... setState(). While our above examples only passed one argument (the update object) to the method, setState will also accept a second argument. The second argument is a callback function that will be fired once setState merges the first argument object with the existing state and rerenders the component. This method of updating, while not preferred by React's developers, more neatly mimics the call-and-response pattern used in API fetch requests. 
          </p>

  <pre class="prettyprint lang=js">
    <code>
import React from 'react'
import Header from './Header'

export default class Applet extends React.Component {
    constructor() {
        super()
        this.state = {
            myState: 'bored',
            myAppetite: 'hungry',
            sleeping: true
         }
    }

    updateMyState = () => { 
        this.setState({
            myState: 'intrigued',
            sleeping: false
        }, this.updateMyAppetite)
    }

    updateMyAppetite = () => {
        const {sleeping, myAppetite, myState} = this.state
        console.log("Between processes, I am", myState, "and", myAppetite)

        if (!sleeping) {
            this.setState({myAppetite: 'satiated'})
        }
    }

    render() {
        return (
            >div onClick={this.updateMyState} style={{backgroundColor: 'yellow'}}>
                >Header passedState={this.state} />
            >div>
    )}
}

// Header.js

import React from 'react'

class Header extends React.Component {
	render() {
		console.log('Upon child render, I am', this.props.passedState.myState, 'and' this.props.passedState.myAppetite)
		return >div>
			>div>My State is {this.props.passedState.myState} >/div>
		>/div>
	}
}

export default Header
    </code>
  </pre>
      
      <h4>Conclusion</h4>

      <p>
        With so many components being constructed, rendered, mounted, and unmounted in a React website, there really is no choice but to set processes up asynchronously. This allows React websites to handle a multitude of event listeners, check for available screenspace, adjust for different browsers, and update the screen dynamically all while keeping the number of component rerenders to a minimum. While updating State values directly is not advised, React provides a number of times during the component lifecycle that state can be updated, in addition to user interaction via event listeners.
      </p>


    </section>
    <div class="post-content">
      <aside class="share">
        <span>Share this: </span>
        <a href="http://twitter.com/share?text=Reacting to the Async State&amp;url=http://mattbechtel1.github.io/posts/react-set-async-state&amp;hashtags=web,dev,blog,soudev&amp;via=nandomoreirame"
          onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <i class="icon icon-twitter-rounded"></i>
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=http://mattbechtel1.github.io/posts/react-set-async-state"
          onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <i class="icon icon-facebook-rounded"></i>
        </a>
      </aside>
    </div>
    <hr>
    <aside id="comments" class="disqus">
      <h3>Comments</h3>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'hello-world-extended';
        var disqus_identifier = '/javascript-iterators';
        var disqus_title = 'Asynchronous State in React';
        var disqus_url = 'http://mattbechtel1.github.io';
        (function () { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://hello-world-extended.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by
          Disqus.</a></noscript>


    </aside>
    </article>
    </section>
    <div class="clearfix"></div>
    <footer class="site-footer txt-center">
      <hr>
      <ul class="social">
        <li><a href="" target="_blank"><i class="icon icon-"></i></a></li>
        <li><a href="http://github.com/mattbechtel1" target="_blank"><i class="icon icon-github"></i></a></li>
        <li><a href="" target="_blank"><i class="icon icon-"></i></a></li>
        <li><a href="http://twitter.com/mattbechtel1" target="_blank"><i class="icon icon-twitter"></i></a></li>
        <li><a href="" target="_blank"><i class="icon icon-"></i></a></li>
        <li><a href="http://linkedin.com/in/mbechtel" target="_blank"><i class="icon icon-linkedin"></i></a></li>
      </ul>
      <small>&copy; 2020 All rights reserved. Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a> and <i
          class="icon icon-heart"></i></small>
      <small>by <a href="http://nandomoreira.me" target="_blank">nandomoreira.me</a></small>
    </footer>
  </main>
  </main> 
</body>

</html>
